<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>AFTRACK Movil</title>
    <base href="/" />

    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/alfacross.css" />
    <link rel="stylesheet" href="css/site.css" />
    <link rel="stylesheet" href="CrossBoxApp.styles.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="imagenes/Rhino.png" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#0d0d0d" />
    <link rel="icon" href="data:,">
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">游딏</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script>
        window.audioUnlocked = false;

        // ESTE ES EL TRUCO: Crear un oscilador silencioso para mantener el audio activo
        function activarModoFiesta() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                const ctx = new AudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                gainNode.gain.value = 0.001; // Casi silencio, pero activo
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                oscillator.start(0);
            }
        }

        window.prepararAudio = () => {
            if (window.audioUnlocked) return;

            // 1. Activar el canal de audio web
            activarModoFiesta();

            // 2. Cargar los sonidos reales
            const audios = ['audio-beep', 'audio-go', 'audio-medio'];
            audios.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.load();
                    el.muted = true;
                    // Forzamos play/pause para "calentar" el archivo
                    el.play().then(() => {
                        el.pause();
                        el.currentTime = 0;
                        el.muted = false;
                    }).catch(e => console.log("Esperando toque..."));
                }
            });
            window.audioUnlocked = true;
        };

        window.reproducirSonido = (id) => {
            const audio = document.getElementById(id);
            if (audio) {
                audio.volume = 1.0;
                // Si Spotify est치 sonando, esto intentar치 sonar encima
                // (En modo Web est치ndar, a veces iOS baja el volumen de la m칰sica autom치ticamente)
                audio.play().catch(e => {
                    console.log("Reintento: " + e);
                    audio.load();
                    audio.play();
                });
            }
        };
    </script>
</body>

</html>